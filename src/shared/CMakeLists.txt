cmake_minimum_required(VERSION 2.6)
project(sensord-shared CXX)

SET(DEPENDENTS "dlog")

INCLUDE(FindPkgConfig)
PKG_CHECK_MODULES(SHARED_PKGS REQUIRED ${DEPENDENTS})

FOREACH(flag ${SHARED_PKGS_CFLAGS})
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${flag}")
ENDFOREACH(flag)
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fPIC")

SET (INSTALL_HEADERS
	sensor_types.h
	sensor_common.h
	sensor_deprecated.h
	enum_factory.h
)

INCLUDE_DIRECTORIES(
	${CMAKE_SOURCE_DIR}/src/hal
	${CMAKE_CURRENT_SOURCE_DIR}
)

FILE(GLOB_RECURSE SRCS *.cpp)
ADD_LIBRARY(${PROJECT_NAME} SHARED ${SRCS})

TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${SHARED_PKGS_LDFLAGS})

INSTALL(TARGETS ${PROJECT_NAME} DESTINATION ${CMAKE_INSTALL_LIBDIR})

FOREACH(HEADER IN ITEMS ${INSTALL_HEADERS})
	INSTALL(FILES ${CMAKE_CURRENT_SOURCE_DIR}/${HEADER} DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/sensor)
ENDFOREACH()
